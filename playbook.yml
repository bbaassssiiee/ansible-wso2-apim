#!/usr/bin/env ansible-playbook
# WSO2 API Manager 3.2.0 install
---

- name: Install database
  hosts: database
  become: true
  serial: 1
  gather_facts: true
  tags:
    - database
    - install
  roles:
    - role: base_postgres
      use_postgresql_org_repo: false
      base_postgres_m: 12
    - role: wso2db

- name: Apply common configuration to wso2apim nodes
  hosts: apim
  gather_facts: true
  become: true
  roles:
    - role: common
      when: ansible_os_family != 'Windows'
      tags:
        - common
        - install
    - role: base_java8
      tags:
        - java
        - install

- name: Install WSO2 API Manager
  hosts: apim
  gather_facts: false
  tags:
    - apim
    - install
  roles:
    - role: apim

- name: Install Load Balancer
  hosts: apim-lb
  gather_facts: false
  tags:
    - lb
    - install
  roles:
    - role: base_java8
